<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
    <title>미남역 열차도착 정보</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/animate.css" />
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,700" rel="stylesheet">
    <script src="./js/modernizr-3.5.0.min.js"></script>


    <link href="css/small-business.css" rel="stylesheet">

    <script src="https://kit.fontawesome.com/db86b98b0a.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="css/weather-icons-wind.css">
    <link rel="stylesheet" href="css/weather-icons-wind.min.css">
    <link rel="stylesheet" href="css/weather-icons.css">
    <style>
        @font-face {
            font-family: 'KOTRA_GOTHIC';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10-21@1.0/KOTRA_GOTHIC.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'KorailRoundGothicBold';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2212@1.0/KorailRoundGothicBold.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }

        @font-face {
            font-family: '777Balsamtint';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_nine_@1.1/777Balsamtint.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        body {
            margin: 0;
            padding: 0;
        }

        .clock {
            font-family: 'KorailRoundGothicBold';
            color: gray;
            font-size: 5em;
        }

        .date {
            font-family: 'KOTRA_GOTHIC';
            color: gray;
            font-size: 3em;
        }

        .weather {
            font-family: '777Balsamtint';
            color: gray;
            font-size: 3em;
        }

        .s_weather {
            font-family: '777Balsamtint';
            letter-spacing: -3px;
            color: gray;
            font-size: 2em;
        }


        .wrap {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .box {
            text-align: center;
        }
    </style>

</head>

<body>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>


    <script>


        // 오늘 날짜를 가져옵니다.
        const today = new Date();

        // 평일, 토요일, 일요일, 공휴일 여부를 판단합니다.
        const isWeekday = today.getDay() !== 0 && today.getDay() !== 6; // 일요일이나 토요일이 아닌 경우
        const isSaturday = today.getDay() === 6; // 토요일인 경우
        const isSunday = today.getDay() === 0; // 일요일인 경우

        // 공휴일 목록을 작성합니다.
        const holidays = [
            new Date('2022-01-01'), // 신정
            new Date('2022-02-01'), // 설날
            new Date('2022-02-02'), // 설날
            new Date('2022-02-03'), // 설날
            new Date('2022-03-01'), // 삼일절
            new Date('2022-05-05'), // 어린이날
            new Date('2022-05-08'), // 석가탄신일
            new Date('2022-06-06'), // 현충일
            new Date('2022-08-15'), // 광복절
            new Date('2022-09-14'), // 추석
            new Date('2022-09-15'), // 추석
            new Date('2022-10-03'), // 개천절
            new Date('2022-12-25') // 성탄절
        ];

        // 오늘이 공휴일인지 확인합니다.
        let isHoliday = false;
        holidays.forEach(holiday => {
            if (holiday.getFullYear() === today.getFullYear() &&
                holiday.getMonth() === today.getMonth() &&
                holiday.getDate() === today.getDate()) {
                isHoliday = true;
            }
        });

        // 결과를 출력합니다.
        if (isHoliday) {
            day_cd = 9;
            day_han = "공휴일";

        } else {
            isWeekday ? day_cd = 8 : isSaturday ? day_cd = 7 : day_cd = 9;
            isWeekday ? day_han = "평일" : isSaturday ? day_han = "토요일" : day_han = "일요일";

        }

        console.log(day_cd);
        console.log(day_han);
        console.log(today.getDay())

        var h1 = today.getHours();
        var m1 = today.getMinutes();
        var s1 = today.getSeconds();
        var t1 = h1+''+m1+''+s1;
       // var t1 = (h1 < 10 ? `0${h1}` : h1) + '' + (m1 < 10 ? `0${m1}` : m1) + '' + (s1 < 10 ? `0${s1}` : s1);

        if(t1<2040 && t1>0){
             if(day_cd == 9){
                day_cd = 7
             } else if(day_cd ==7){
                day_cd = 8
             }
        } 

      
        console.log(t1);
        console.log(day_cd);


        $.ajax({
            method: "GET",

            //url: "http://hopesos.dothome.co.kr/alltimeposter.json"
            url: "https://openapi.kric.go.kr/openapi/trainUseInfo/subwayTimetable?serviceKey=$2a$10$l3epFs0f4zM9qRe7x9hXueiHsovU.Jb7PomRkK.qvlSCP5sDVZdpW&format=json&railOprIsttCd=BS&dayCd=" + day_cd + "&lnCd=3&stinCd=309"
            //url: "alltimeposter.json"
        })
            .done(function (p) {
                console.log(p);
                var time = new Date();
                var years = time.getFullYear();
                var month = time.getMonth();
                var date = time.getDate();

                var hours = time.getHours();

                if (hours < 10 && hours > 0) {
                    hours = '0' + hours;
                } else if (hours == 0) {
                    hours = '24';
                } else {
                    hours = hours;
                }

                var minutes = time.getMinutes();
                var seconds = time.getSeconds();

                var cur_time = (hours) + '' + (minutes < 10 ? `0${minutes}` : minutes) + '' + (seconds < 10 ? `0${seconds}` : seconds);
                //  console.log(cur_time);

                var arr_new_3minam1 = new Array();
                var arr_new_sub_3minam_up = new Array();
                var arr_new_sub_3minam_dn = new Array();

                for (i = 0; i < p.body.length; i++) {
                    arr_new_3minam1.push([p.body[i].trnNo, p.body[i].arvTm]);
                }

                

                    const arr_new_3minam = arr_new_3minam1.map(row => {
                        return row.map(str => {
                            if (str === "000425") {
                                return "240425";
                            } else if (str === "000030") {
                                return "240030";
                            } else if (str === "001655") {
                                return "241655";
                            }
                            else {
                                return str;
                            }
                        });
                    });

                

                // console.log(arr_new_3minam); 

                arr_new_3minam.sort(function (a, b) {
                    return a[0] - b[0];
                });

                let sorted_new_arr_3minam = [];

                // 작은 값부터 큰 값 순으로 새로운 배열에 저장
                for (let i = 0; i < arr_new_3minam.length; i++) {
                    sorted_new_arr_3minam.push(arr_new_3minam[i]);
                }

                // console.log(sorted_new_arr_3minam);


                for (i = 0; i < sorted_new_arr_3minam.length; i++) {

                    new_3sub = cur_time - arr_new_3minam[i][1];
                    // console.log(sorted_new_arr_4minam_dn[i][0]);

                    if (new_3sub < 0) {
                        if (sorted_new_arr_3minam[i][0] % 2 == 0) {
                            arr_new_sub_3minam_dn.push(sorted_new_arr_3minam[i]);
                        } else {
                            arr_new_sub_3minam_up.push(sorted_new_arr_3minam[i]);
                        }
                    }
                }

                $("#day_hann").append(day_han);


                if (cur_time > 240030 && cur_time <= 245959) {

                    $("#minam_up").append("열차운행 종료<br>");
                    $("#minam_up").append("<div class='gr-line'></div>");
                } else {

                    var length_3up = arr_new_sub_3minam_up.length;
                    

                    for (i = 0; i < length_3up; i++) {

                        var arv_3minam_up_tm = arr_new_sub_3minam_up[i][1].substr(0, 2) + ':' + arr_new_sub_3minam_up[i][1].substr(2, 2) + ':' + arr_new_sub_3minam_up[i][1].substr(4, 2);

                        $("#minam_up").append(arv_3minam_up_tm + "<br>");
                        $("#minam_up").append("<div class='gr-line'></div>");
                    }


                    const ho_up = arr_new_sub_3minam_up[0][1].substr(0, 2);
                    const mi_up = arr_new_sub_3minam_up[0][1].substr(2, 2);
                    const se_up = arr_new_sub_3minam_up[0][1].substr(4, 2);


                    const targetDate_up = new Date(years, month, date, ho_up, mi_up, se_up);

                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_up - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_3minam_up");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 열차도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "열차 출발";
                        }
                    }, 1000);

                }
                if (cur_time > 241655 && cur_time <= 245959) {

                    $("#minam_dn").append("<span class='sche'>열차운행 종료</span>");
                    $("#minam_dn").append("<div class='gr-line'></div>");

                } else {
                   var length_3dn = arr_new_sub_3minam_dn.length;
                  //  var length_3dn = 5;

                    for (i = 0; i < length_3dn; i++) {
                        var arv_3minam_dn_tm = arr_new_sub_3minam_dn[i][1].substr(0, 2) + ':' + arr_new_sub_3minam_dn[i][1].substr(2, 2) + ':' + arr_new_sub_3minam_dn[i][1].substr(4, 2);
                       
                        const ho_dn_i = arr_new_sub_3minam_dn[i][1].substr(0, 2);
                        const mi_dn_i = arr_new_sub_3minam_dn[i][1].substr(2, 2);
                        const se_dn_i = arr_new_sub_3minam_dn[i][1].substr(4, 2);
                        const targetDate_dn_i = new Date(years, month, date, ho_dn_i, mi_dn_i, se_dn_i);

                        const now1 = new Date().getTime();
                        const timeLeft1 = targetDate_dn_i - now1;

                        // 남은 시간 계산
                        const days1 = Math.floor(timeLeft1 / (1000 * 60 * 60 * 24));
                        const hours1 = Math.floor((timeLeft1 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes1 = Math.floor((timeLeft1 % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds1 = Math.floor((timeLeft1 % (1000 * 60)) / 1000);

                        var countdown_3minam_dn1 = (hours1 < 10 ? `0${hours1}` : hours1) +':' + (minutes1 < 10 ? `0${minutes1}` : minutes1)+ ':'+ (seconds1 < 10 ? `0${seconds1}` : seconds1);
                     //   var countdown_3minam_dn1 = minutes1 +'' ;
                     //   $("#countdown_3minam_dn1").append(countdown_3minam_dn1);
                        $("#minam_dn").append("<span class='sche5'>"+ countdown_3minam_dn1 +"</span>   <span class='sche'>" +arv_3minam_dn_tm+"</span><br>");
                        $("#minam_dn").append("<div class='gr-line'></div>");

                        console.log(countdown_3minam_dn1);
                    }

                    const ho_dn = arr_new_sub_3minam_dn[0][1].substr(0, 2);
                    const mi_dn = arr_new_sub_3minam_dn[0][1].substr(2, 2);
                    const se_dn = arr_new_sub_3minam_dn[0][1].substr(4, 2);

                    const targetDate_dn = new Date(years, month, date, ho_dn, mi_dn, se_dn);
                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_dn - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_3minam_dn");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 열차도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "열차 출발";
                        }
                    }, 1000);

                }

            });

        $.ajax({
            method: "GET",
            url: "https://openapi.kric.go.kr/openapi/trainUseInfo/subwayTimetable?serviceKey=$2a$10$l3epFs0f4zM9qRe7x9hXueiHsovU.Jb7PomRkK.qvlSCP5sDVZdpW&format=json&railOprIsttCd=BS&dayCd="+day_cd+"&lnCd=4&stinCd=401"
        })
            .done(function (p) {
                console.log(p);
                var time = new Date();
                var years = time.getFullYear();
                var month = time.getMonth();
                var date = time.getDate();

                var hours = time.getHours();

                if (hours < 10 && hours > 0) {
                    hours = '0' + hours;
                } else if (hours == 0) {
                    hours = '24';
                } else {
                    hours = hours;
                }
                var minutes = time.getMinutes();
                var seconds = time.getSeconds();

                var cur_time = (hours) + '' + (minutes < 10 ? `0${minutes}` : minutes) + '' + (seconds < 10 ? `0${seconds}` : seconds);
                //console.log(cur_time);

                var arr_new_4minam = new Array();
                var arr_new_sub_4minam_dn = new Array();

                for (i = 0; i < p.body.length; i++) {
                    arr_new_4minam.push([p.body[i].trnNo, p.body[i].arvTm]);
                }
                // console.log(arr_new_4minam);

                const arr_new_4minam_dn = arr_new_4minam.map(row => {
                    return row.map(str => {
                        if (str === "000900") {
                            return "240900";
                        } else if (str === "000200") {
                            return "240200";
                        } else if (str === "001200") {
                            return "241200";
                        } else if (str === "002040") {
                            return "242040";
                        }
                        else {
                            return str;
                        }
                    });
                });

                // console.log(arr_new_4minam_dn);

                arr_new_4minam_dn.sort(function (a, b) {
                    return a[0] - b[0];
                });

                let sorted_new_arr_4minam_dn = [];

                // 작은 값부터 큰 값 순으로 새로운 배열에 저장
                for (let i = 0; i < arr_new_4minam_dn.length; i++) {
                    sorted_new_arr_4minam_dn.push(arr_new_4minam_dn[i]);
                }

                for (i = 0; i < sorted_new_arr_4minam_dn.length; i++) {

                    new_sub = cur_time - sorted_new_arr_4minam_dn[i][1];

                    if (new_sub < 0) {
                        if (sorted_new_arr_4minam_dn[i][0] % 2 == 0) {
                            arr_new_sub_4minam_dn.push(sorted_new_arr_4minam_dn[i]);

                        } else if (new_sub > 0) {
                            $("#4minam_dn").append("열차운행 종료 <br>");
                            $("#4minam_dn").append("<div class='gr-line'></div>");
                        }
                    }
                }


                if (cur_time > 242040 && cur_time <= 245959) {

                    $("#4minam_dn").append("열차운행 종료<br>");
                    $("#4minam_dn").append("<div class='gr-line'></div>");
                } else {


                    var length4 = arr_new_sub_4minam_dn.length;
                  //  var length4 = 5;

                    for (i = 0; i < length4; i++) {
                        var arv_4minam_dn_tm = arr_new_sub_4minam_dn[i][1].substr(0, 2) + ':' + arr_new_sub_4minam_dn[i][1].substr(2, 2) + ':' + arr_new_sub_4minam_dn[i][1].substr(4, 2);
                        $("#4minam_dn").append(arv_4minam_dn_tm + "<br>");
                        $("#4minam_dn").append("<div class='gr-line'></div>");
                    }

                    // 타겟 날짜 설정 (년, 월 - 1, 일, 시, 분, 초)
                    const ho = arr_new_sub_4minam_dn[0][1].substr(0, 2);
                    const mi = arr_new_sub_4minam_dn[0][1].substr(2, 2);
                    const se = arr_new_sub_4minam_dn[0][1].substr(4, 2);

                    const targetDate = new Date(years, month, date, ho, mi, se);

                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_4minam");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 열차도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "열차 통과";
                        }
                    }, 1000);

                }
            });


    </script>




    <div class="top-bar">
        <div class="sche3">
            <center>미남역 열차도착(<span id="day_hann"></span>) </center>
        </div>
    </div>

    <div class="wrap">
        <div class="box">
            <span id="clock" class="clock">clock</span><br>
            <span id="apm" class="date">apm</span><br>
        </div>

    </div>

    <script>
        var Target = document.getElementById("clock");
        var Target_apm = document.getElementById("apm");
        function clock() {
            var time = new Date();
            var years = time.getFullYear();
            var month = time.getMonth();
            var date = time.getDate();
            var day = time.getDay();
            var week = ['일', '월', '화', '수', '목', '금', '토'];

            var hours = time.getHours();
            var minutes = time.getMinutes();
            var seconds = time.getSeconds();

            Target.innerText =
                `${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds}`;

            Target_apm.innerText = `${years}.${month + 1}.${date}(${week[day]}) `;

        }
        clock();
        setInterval(clock, 1000); // 1초마다 실행
    </script>

   


    <div class="smoke">
        <div class="container" id="fh5co-pricing">
            <div class="row">
                <div class="col-sm-4 animate-box" data-animate-effect="fadeInLeft">
                    <div class="price-box">
                        <h3 class="sche"><b>3호선 수영행</b></h3>
                        <h3 class="sche5" id="countdown_3minam_up"></h3>
                        <div class="gr-line"></div>
                        <div>
                            <h3 id="minam_up" class="sche"></h3>
                        </div>


                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="price-box-dark animate-box">
                        <h3 class="sche2"><b>4호선 안평행</b></h3>
                        <h3 class="sche4" id="countdown_4minam"></h3>
                        <div class="gr-line"></div>
                        <div>
                            <h3 id="4minam_dn" class="sche2"></h3>

                        </div>

                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="price-box animate-box" data-animate-effect="fadeInRight">
                        <h3 class="sche"><b>3호선 대저행</b></h3>
                        <h3 class="sche5" id="countdown_3minam_dn"></h3>
                        <div class="gr-line"></div>
                        <div id="minam_dn">
                         
                            
                        </div>



                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--
<div class="darker">
    <div class="container" id="fh5co-legal">
        <div class="row">
            <div class="col-sm-8 text-white mtext-center">
               
            </div>
           
        </div>
    </div>
</div>
-->

    <!--<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>-->
    <script src="./js/jquery.min.js"></script>
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>-->
    <script src="./js/bootstrap.min.js"></script>
    <!--<script src="https://use.fontawesome.com/8e45396e2e.js"></script>-->
    <script src="./js/fontawesome.js"></script>
    <script src="./js/jquery.waypoints.min.js"></script>
    <script src="./js/animate.js"></script>
    <script>
        setInterval(function () {
            location.reload();
        }, 60000);

    </script>

</body>

</html>
