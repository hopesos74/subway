<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">

    <title>미남역 도착정보</title>
    <style>
        .top {
            background: orange;
            margin: 10px 10px 10px 10px;
            font-family: 'GangwonEdu_OTFBoldA';
            color: black;
            font-size: 2.2em;
            text-align: center;
        }

        .time {
            font-family: 'GangwonEdu_OTFBoldA';
            font-size: 0.8em;
        }




        .container {
            background: beige;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-content: space-around;
            align-items: flex-start;
            margin: 10px 10px 10px 10px;
        }

        .item {
            width: 300px;
            text-align: center;
            padding: 5px;
            margin: 10px 10px 10px 10px;

        }

        .item1 {
            background: #dfc6ee;
        }

        .item2 {
            background: rgb(215, 236, 185);
        }

        .item3 {
            background: #a3c7e2;
        }

        .item4 {
            background: #db99e7;
        }

        .item5 {
            background: #db99e7;
        }

        .item6 {
            background: #db99e7;
        }

        .item7 {
            background: #955ff4;
        }




        .sche {
            font-family: 'GangwonEdu_OTFBoldA';
            color: black;
            font-size: 2.5em;
            margin-top: 10px;
            margin-bottom: 10px;
            text-align: center;
        }

        .sche1 {
            font-family: 'GangwonEdu_OTFBoldA';
            color: black;
            font-size: 1.5em;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .gr-line {
            border-bottom: 1px solid #24b540;
            margin: 1px;
        }




        @font-face {
            font-family: 'KOTRA_GOTHIC';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10-21@1.0/KOTRA_GOTHIC.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'KorailRoundGothicBold';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2212@1.0/KorailRoundGothicBold.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }


        @font-face {
            font-family: 'GangwonEdu_OTFBoldA';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2201-2@1.0/GangwonEdu_OTFBoldA.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
    </style>
</head>

<body>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>


    <script>


        // 오늘 날짜를 가져옵니다.
        const today = new Date();

        // 평일, 토요일, 일요일, 공휴일 여부를 판단합니다.
        const isWeekday = today.getDay() !== 0 && today.getDay() !== 6; // 일요일이나 토요일이 아닌 경우
        const isSaturday = today.getDay() === 6; // 토요일인 경우
        const isSunday = today.getDay() === 0; // 일요일인 경우

        // 공휴일 목록을 작성합니다.
        const holidays = [
           
            new Date('2023-05-05'), // 어린이날
            new Date('2023-05-27'), // 석가탄신일
            new Date('2023-05-29'), // 대체공휴일
            new Date('2023-06-06'), // 현충일
            new Date('2023-08-15'), // 광복절
            new Date('2023-09-28'), // 추석
            new Date('2023-09-29'), // 추석
            new Date('2023-09-30'), // 추석
            new Date('2023-10-03'), // 개천절
            new Date('2023-10-09'), // 한글날
            new Date('2023-12-25') // 성탄절
        ];

        // 오늘이 공휴일인지 확인합니다.
        let isHoliday = false;
        holidays.forEach(holiday => {
            if (holiday.getFullYear() === today.getFullYear() &&
                holiday.getMonth() === today.getMonth() &&
                holiday.getDate() === today.getDate()) {
                isHoliday = true;
            }
        });

        // 결과를 출력합니다.
        if (isHoliday) {
            day_cd = 9;
            day_han = "공휴일";

        } else {
            isWeekday ? day_cd = 8 : isSaturday ? day_cd = 7 : day_cd = 9;
            isWeekday ? day_han = "평일" : isSaturday ? day_han = "토요일" : day_han = "일요일";

        }
      //  console.log(day_cd);
      //  console.log(day_han);
      //  console.log(today.getDay())

        var h1 = today.getHours();
        var m1 = today.getMinutes();
        var s1 = today.getSeconds();
        var t1 = h1 + '' + m1 + '' + s1;
        // var t1 = (h1 < 10 ? `0${h1}` : h1) + '' + (m1 < 10 ? `0${m1}` : m1) + '' + (s1 < 10 ? `0${s1}` : s1);

        if (t1 < 2040 && t1 > 0) {
            if (day_cd == 9) {
                day_cd = 7
            } else if (day_cd == 7) {
                day_cd = 8
            }
        }


       // console.log(t1);
       // console.log(day_cd);


        $.ajax({
            method: "GET",

            url: "https://openapi.kric.go.kr/openapi/trainUseInfo/subwayTimetable?serviceKey=$2a$10$l3epFs0f4zM9qRe7x9hXueiHsovU.Jb7PomRkK.qvlSCP5sDVZdpW&format=json&railOprIsttCd=BS&dayCd=" + day_cd + "&lnCd=3&stinCd=309"
        })
            .done(function (p) {
               // console.log(p);
                var time = new Date();
                var years = time.getFullYear();
                var month = time.getMonth();
                var date = time.getDate();

                var hours = time.getHours();

                if (hours < 10 && hours > 0) {
                    hours = '0' + hours;
                } else if (hours == 0) {
                    hours = '24';
                } else {
                    hours = hours;
                }

                var minutes = time.getMinutes();
                var seconds = time.getSeconds();

                var cur_time = (hours) + '' + (minutes < 10 ? `0${minutes}` : minutes) + '' + (seconds < 10 ? `0${seconds}` : seconds);
                //  console.log(cur_time);

                var arr_new_3minam1 = new Array();
                var arr_new_sub_3minam_up = new Array();
                var arr_new_sub_3minam_dn = new Array();

                for (i = 0; i < p.body.length; i++) {
                    arr_new_3minam1.push([p.body[i].trnNo, p.body[i].arvTm]);
                }

                //새로운 배열에 열차번호와 도착시간 저장

                const arr_new_3minam = arr_new_3minam1.map(row => {
                    return row.map(str => {
                        if (str === "000425") {
                            return "240425";
                        } else if (str === "000030") {
                            return "240030";
                        } else if (str === "001655") {
                            return "241655";
                        }
                        else {
                            return str;
                        }
                    });
                });

                // 도착시간을 24시간제로 변경


                arr_new_3minam.sort(function (a, b) {
                    return a[0] - b[0];
                });
               // 시간순으로 정렬


                //작은 값 새로운 배열 정의
                let sorted_new_arr_3minam = [];

                // 작은 값부터 큰 값 순으로 새로운 배열에 저장
                for (let i = 0; i < arr_new_3minam.length; i++) {
                    sorted_new_arr_3minam.push(arr_new_3minam[i]);
                }

                for (i = 0; i < sorted_new_arr_3minam.length; i++) {

                    new_3sub = cur_time - arr_new_3minam[i][1];
                    // 현재시간과 도착시간 차이

                    if (new_3sub < 0) {
                        if (sorted_new_arr_3minam[i][0] % 2 == 0) {
                            arr_new_sub_3minam_dn.push(sorted_new_arr_3minam[i]);
                            //열차번호가 짝수이면 하선
                        } else {
                            arr_new_sub_3minam_up.push(sorted_new_arr_3minam[i]);
                            //열차번호가 홀수이면 상선
                        }
                    }
                }

                $("#day_hann").append(day_han);


                if (cur_time > 240030 && cur_time <= 245959) {

                    $("#minam_up").append("열차운행 종료<br>");
                    $("#minam_up").append("<div class='gr-line'></div>");
                } else {

                    var length_3up = arr_new_sub_3minam_up.length;

                    if (length_3up > 3) {
                        length_3up = 3;
                    }


                    for (i = 0; i < length_3up; i++) {

                        var arv_3minam_up_tm = arr_new_sub_3minam_up[i][1].substr(0, 2) + ':' + arr_new_sub_3minam_up[i][1].substr(2, 2) + ':' + arr_new_sub_3minam_up[i][1].substr(4, 2);

                        $("#minam_up").append(arv_3minam_up_tm + "<br>");
                        $("#minam_up").append("<div class='gr-line'></div>");
                    }


                    const ho_up = arr_new_sub_3minam_up[0][1].substr(0, 2);
                    const mi_up = arr_new_sub_3minam_up[0][1].substr(2, 2);
                    const se_up = arr_new_sub_3minam_up[0][1].substr(4, 2);


                    const targetDate_up = new Date(years, month, date, ho_up, mi_up, se_up);

                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_up - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_3minam_up");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }
                if (cur_time > 241655 && cur_time <= 245959) {

                    $("#minam_dn").append("열차운행 종료");
                    $("#minam_dn").append("<div class='gr-line'></div>");

                } else {
                    var length_3dn = arr_new_sub_3minam_dn.length;

                    if (length_3dn > 3) {
                        length_3dn = 3;
                    }

                    //  var length_3dn = 5;

                    for (i = 0; i < length_3dn; i++) {
                        var arv_3minam_dn_tm = arr_new_sub_3minam_dn[i][1].substr(0, 2) + ':' + arr_new_sub_3minam_dn[i][1].substr(2, 2) + ':' + arr_new_sub_3minam_dn[i][1].substr(4, 2);

                        const ho_dn_i = arr_new_sub_3minam_dn[i][1].substr(0, 2);
                        const mi_dn_i = arr_new_sub_3minam_dn[i][1].substr(2, 2);
                        const se_dn_i = arr_new_sub_3minam_dn[i][1].substr(4, 2);
                        const targetDate_dn_i = new Date(years, month, date, ho_dn_i, mi_dn_i, se_dn_i);

                        const now1 = new Date().getTime();
                        const timeLeft1 = targetDate_dn_i - now1;

                        // 남은 시간 계산
                        const days1 = Math.floor(timeLeft1 / (1000 * 60 * 60 * 24));
                        const hours1 = Math.floor((timeLeft1 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes1 = Math.floor((timeLeft1 % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds1 = Math.floor((timeLeft1 % (1000 * 60)) / 1000);

                        //  var countdown_3minam_dn1 = (hours1 < 10 ? `0${hours1}` : hours1) +':' + (minutes1 < 10 ? `0${minutes1}` : minutes1)+ ':'+ (seconds1 < 10 ? `0${seconds1}` : seconds1);
                        var countdown_3minam_dn1 = (minutes1 < 10 ? `0${minutes1}` : minutes1) + '분 ' + (seconds1 < 10 ? `0${seconds1}` : seconds1) + '초 ';

                        //   var countdown_3minam_dn1 = minutes1 +'' ;
                        //   $("#countdown_3minam_dn1").append(countdown_3minam_dn1);
                        // $("#minam_dn").append("<span class='sche5'>" + countdown_3minam_dn1 + "</span>   <span class='sche'>" + arv_3minam_dn_tm + "</span><br>");
                        $("#minam_dn").append(arv_3minam_dn_tm + "<br>");
                        $("#minam_dn").append("<div class='gr-line'></div>");

                  //      console.log(countdown_3minam_dn1);
                    }

                    const ho_dn = arr_new_sub_3minam_dn[0][1].substr(0, 2);
                    const mi_dn = arr_new_sub_3minam_dn[0][1].substr(2, 2);
                    const se_dn = arr_new_sub_3minam_dn[0][1].substr(4, 2);

                    const targetDate_dn = new Date(years, month, date, ho_dn, mi_dn, se_dn);
                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_dn - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_3minam_dn");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }

            });
/*
        $.ajax({
            method: "GET",
            url: "https://openapi.kric.go.kr/openapi/trainUseInfo/subwayTimetable?serviceKey=$2a$10$l3epFs0f4zM9qRe7x9hXueiHsovU.Jb7PomRkK.qvlSCP5sDVZdpW&format=json&railOprIsttCd=BS&dayCd=" + day_cd + "&lnCd=4&stinCd=401"
        })
            .done(function (p) {
               // console.log(p);
                var time = new Date();
                var years = time.getFullYear();
                var month = time.getMonth();
                var date = time.getDate();

                var hours = time.getHours();

                if (hours < 10 && hours > 0) {
                    hours = '0' + hours;
                } else if (hours == 0) {
                    hours = '24';
                } else {
                    hours = hours;
                }
                var minutes = time.getMinutes();
                var seconds = time.getSeconds();

                var cur_time = (hours) + '' + (minutes < 10 ? `0${minutes}` : minutes) + '' + (seconds < 10 ? `0${seconds}` : seconds);
                //console.log(cur_time);

                var arr_new_4minam = new Array();
                var arr_new_sub_4minam_dn = new Array();

                for (i = 0; i < p.body.length; i++) {
                    arr_new_4minam.push([p.body[i].trnNo, p.body[i].arvTm]);
                }
                // console.log(arr_new_4minam);

                const arr_new_4minam_dn = arr_new_4minam.map(row => {
                    return row.map(str => {
                        if (str === "000900") {
                            return "240900";
                        } else if (str === "000200") {
                            return "240200";
                        } else if (str === "001200") {
                            return "241200";
                        } else if (str === "002040") {
                            return "242040";
                        }
                        else {
                            return str;
                        }
                    });
                });

                // console.log(arr_new_4minam_dn);

                arr_new_4minam_dn.sort(function (a, b) {
                    return a[0] - b[0];
                });

                let sorted_new_arr_4minam_dn = [];

                // 작은 값부터 큰 값 순으로 새로운 배열에 저장
                for (let i = 0; i < arr_new_4minam_dn.length; i++) {
                    sorted_new_arr_4minam_dn.push(arr_new_4minam_dn[i]);
                }

                for (i = 0; i < sorted_new_arr_4minam_dn.length; i++) {

                    new_sub = cur_time - sorted_new_arr_4minam_dn[i][1];

                    if (new_sub < 0) {
                        if (sorted_new_arr_4minam_dn[i][0] % 2 == 0) {
                            arr_new_sub_4minam_dn.push(sorted_new_arr_4minam_dn[i]);

                        } else if (new_sub > 0) {
                            $("#4minam_dn").append("열차운행 종료 <br>");
                            $("#4minam_dn").append("<div class='gr-line'></div>");
                        }
                    }
                }

                if (cur_time > 242040 && cur_time <= 245959) {

                    $("#4minam_dn").append("열차운행 종료<br>");
                    $("#4minam_dn").append("<div class='gr-line'></div>");
                } else {


                    var length4 = arr_new_sub_4minam_dn.length;

                    if (length4 > 3) {
                        length4 = 3;
                    }

                    //  var length4 = 5;

                    for (i = 0; i < length4; i++) {
                        var arv_4minam_dn_tm = arr_new_sub_4minam_dn[i][1].substr(0, 2) + ':' + arr_new_sub_4minam_dn[i][1].substr(2, 2) + ':' + arr_new_sub_4minam_dn[i][1].substr(4, 2);
                        $("#4minam_dn").append(arv_4minam_dn_tm + "<br>");
                        $("#4minam_dn").append("<div class='gr-line'></div>");
                    }

                    // 타겟 날짜 설정 (년, 월 - 1, 일, 시, 분, 초)
                    const ho = arr_new_sub_4minam_dn[0][1].substr(0, 2);
                    const mi = arr_new_sub_4minam_dn[0][1].substr(2, 2);
                    const se = arr_new_sub_4minam_dn[0][1].substr(4, 2);

                    const targetDate = new Date(years, month, date, ho, mi, se);

                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_4minam");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }
            });
*/
            $.ajax({
            method: "GET",

            url: "https://openapi.kric.go.kr/openapi/trainUseInfo/subwayTimetable?serviceKey=$2a$10$l3epFs0f4zM9qRe7x9hXueiHsovU.Jb7PomRkK.qvlSCP5sDVZdpW&format=json&railOprIsttCd=BS&dayCd=" + day_cd + "&lnCd=3&stinCd=317"
        })
            .done(function (p) {
               // console.log(p);
                var time = new Date();
                var years = time.getFullYear();
                var month = time.getMonth();
                var date = time.getDate();

                var hours = time.getHours();

                if (hours < 10 && hours > 0) {
                    hours = '0' + hours;
                } else if (hours == 0) {
                    hours = '24';
                } else {
                    hours = hours;
                }

                var minutes = time.getMinutes();
                var seconds = time.getSeconds();

                var cur_time = (hours) + '' + (minutes < 10 ? `0${minutes}` : minutes) + '' + (seconds < 10 ? `0${seconds}` : seconds);
                //  console.log(cur_time);

                var arr_new_3minam1 = new Array();
                var arr_new_sub_3minam_up = new Array();
                var arr_new_sub_3minam_dn = new Array();

                for (i = 0; i < p.body.length; i++) {
                    arr_new_3minam1.push([p.body[i].trnNo, p.body[i].arvTm]);
                }

                const arr_new_3minam = arr_new_3minam1.map(row => {
                    return row.map(str => {
                        if (str === "000425") {
                            return "240425";
                        } else if (str === "000030") {
                            return "240030";
                        } else if (str === "001655") {
                            return "241655";
                        }
                        else {
                            return str;
                        }
                    });
                });



                // console.log(arr_new_3minam); 

                arr_new_3minam.sort(function (a, b) {
                    return a[0] - b[0];
                });

                let sorted_new_arr_3minam = [];

                // 작은 값부터 큰 값 순으로 새로운 배열에 저장
                for (let i = 0; i < arr_new_3minam.length; i++) {
                    sorted_new_arr_3minam.push(arr_new_3minam[i]);
                }

               //  console.log(sorted_new_arr_3minam);


                for (i = 0; i < sorted_new_arr_3minam.length; i++) {

                    new_3sub = cur_time - arr_new_3minam[i][1];
                    // console.log(sorted_new_arr_4minam_dn[i][0]);

                    if (new_3sub < 0) {
                        if (sorted_new_arr_3minam[i][0] % 2 == 0) {
                           
                        } else {
                            arr_new_sub_3minam_up.push(sorted_new_arr_3minam[i]);
                        }
                    }
                }



                if (cur_time > 240030 && cur_time <= 245959) {

                    $("#daejeo_up").append("열차운행 종료<br>");
                    $("#daejeo_up").append("<div class='gr-line'></div>");
                } else {

                    var length_3up = arr_new_sub_3minam_up.length;

                    if (length_3up > 3) {
                        length_3up = 3;
                    }


                    for (i = 0; i < length_3up; i++) {

                        var arv_3minam_up_tm = arr_new_sub_3minam_up[i][1].substr(0, 2) + ':' + arr_new_sub_3minam_up[i][1].substr(2, 2) + ':' + arr_new_sub_3minam_up[i][1].substr(4, 2);

                        $("#daejeo_up").append(arv_3minam_up_tm + "<br>");
                        $("#daejeo_up").append("<div class='gr-line'></div>");
                    }


                    const ho_up = arr_new_sub_3minam_up[0][1].substr(0, 2);
                    const mi_up = arr_new_sub_3minam_up[0][1].substr(2, 2);
                    const se_up = arr_new_sub_3minam_up[0][1].substr(4, 2);


                    const targetDate_up = new Date(years, month, date, ho_up, mi_up, se_up);

                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_up - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_3daejeo_up");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }
               
            });



            $.ajax({
            method: "GET",

            url: "https://openapi.kric.go.kr/openapi/trainUseInfo/subwayTimetable?serviceKey=$2a$10$l3epFs0f4zM9qRe7x9hXueiHsovU.Jb7PomRkK.qvlSCP5sDVZdpW&format=json&railOprIsttCd=BG&dayCd=" + day_cd + "&lnCd=B1&stinCd=0117"
        })
            .done(function (p) {
               console.log(p);
                var time = new Date();
                var years = time.getFullYear();
                var month = time.getMonth();
                var date = time.getDate();

                var hours = time.getHours();

                if (hours < 10 && hours > 0) {
                    hours = '0' + hours;
                } else if (hours == 0) {
                    hours = '24';
                } else {
                    hours = hours;
                }

                var minutes = time.getMinutes();
                var seconds = time.getSeconds();

                var cur_time = (hours) + '' + (minutes < 10 ? `0${minutes}` : minutes) + '' + (seconds < 10 ? `0${seconds}` : seconds);
                //  console.log(cur_time);

                var arr_new_3minam1 = new Array();
                var arr_new_up = new Array();
                var arr_new_dn = new Array();

                for (i = 0; i < p.body.length; i++) {
                    arr_new_3minam1.push([p.body[i].trnNo, p.body[i].arvTm]);
                }



                const arr_new_3minam = arr_new_3minam1.map(row => {
                    return row.map(str => {
                        if (str === "000400") {
                            return "240400";
                        } else if (str === "001250") {
                            return "241250";
                        } 
                        else {
                            return str;
                        }
                    });
                });



               //  console.log(arr_new_3minam); 

                arr_new_3minam.sort(function (a, b) {
                    return a[0] - b[0];
                });

                let sorted_new_arr_3minam = [];

                // 작은 값부터 큰 값 순으로 새로운 배열에 저장
                for (let i = 0; i < arr_new_3minam.length; i++) {
                    sorted_new_arr_3minam.push(arr_new_3minam[i]);
                }

                // console.log(sorted_new_arr_3minam);


                for (i = 0; i < sorted_new_arr_3minam.length; i++) {

                    new_3sub = cur_time - arr_new_3minam[i][1];
                    // console.log(sorted_new_arr_4minam_dn[i][0]);

                    if (new_3sub < 0) {
                        if (sorted_new_arr_3minam[i][0] < 2000) {
                            arr_new_up.push(sorted_new_arr_3minam[i]);
                        } else {
                            arr_new_dn.push(sorted_new_arr_3minam[i]);
                        }
                    }
                }
              //  console.log(arr_new_up);
             //       console.log(arr_new_dn);
                   
               


                if (cur_time > 234448 && cur_time <= 245959) {

                    $("#suro_up").append("열차운행 종료<br>");
                    $("#suro_up").append("<div class='gr-line'></div>");
                } else {

                    var length_3up = arr_new_up.length;

                    if (length_3up > 3) {
                        length_3up = 3;
                    }


                    for (i = 0; i < length_3up; i++) {

                        var arv_3minam_up_tm = arr_new_up[i][1].substr(0, 2) + ':' + arr_new_up[i][1].substr(2, 2) + ':' + arr_new_up[i][1].substr(4, 2);

                        $("#suro_up").append(arv_3minam_up_tm + "<br>");
                        $("#suro_up").append("<div class='gr-line'></div>");
                    }


                    const ho_up = arr_new_up[0][1].substr(0, 2);
                    const mi_up = arr_new_up[0][1].substr(2, 2);
                    const se_up = arr_new_up[0][1].substr(4, 2);


                    const targetDate_up = new Date(years, month, date, ho_up, mi_up, se_up);

                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_up - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_suro_up");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }
                if (cur_time > 241655 && cur_time <= 245959) {

                    $("#suro_dn").append("열차운행 종료");
                    $("#suro_dn").append("<div class='gr-line'></div>");

                } else {
                    var length_3dn = arr_new_dn.length;

                    if (length_3dn > 3) {
                        length_3dn = 3;
                    }

                    //  var length_3dn = 5;

                    for (i = 0; i < length_3dn; i++) {
                        var arv_3minam_dn_tm = arr_new_dn[i][1].substr(0, 2) + ':' + arr_new_dn[i][1].substr(2, 2) + ':' + arr_new_dn[i][1].substr(4, 2);

                        const ho_dn_i = arr_new_dn[i][1].substr(0, 2);
                        const mi_dn_i = arr_new_dn[i][1].substr(2, 2);
                        const se_dn_i = arr_new_dn[i][1].substr(4, 2);
                        const targetDate_dn_i = new Date(years, month, date, ho_dn_i, mi_dn_i, se_dn_i);

                        const now1 = new Date().getTime();
                        const timeLeft1 = targetDate_dn_i - now1;

                        // 남은 시간 계산
                        const days1 = Math.floor(timeLeft1 / (1000 * 60 * 60 * 24));
                        const hours1 = Math.floor((timeLeft1 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes1 = Math.floor((timeLeft1 % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds1 = Math.floor((timeLeft1 % (1000 * 60)) / 1000);

                        //  var countdown_3minam_dn1 = (hours1 < 10 ? `0${hours1}` : hours1) +':' + (minutes1 < 10 ? `0${minutes1}` : minutes1)+ ':'+ (seconds1 < 10 ? `0${seconds1}` : seconds1);
                        var countdown_3minam_dn1 = (minutes1 < 10 ? `0${minutes1}` : minutes1) + '분 ' + (seconds1 < 10 ? `0${seconds1}` : seconds1) + '초 ';

                        //   var countdown_3minam_dn1 = minutes1 +'' ;
                        //   $("#countdown_3minam_dn1").append(countdown_3minam_dn1);
                        // $("#minam_dn").append("<span class='sche5'>" + countdown_3minam_dn1 + "</span>   <span class='sche'>" + arv_3minam_dn_tm + "</span><br>");
                        $("#suro_dn").append(arv_3minam_dn_tm + "<br>");
                        $("#suro_dn").append("<div class='gr-line'></div>");

                       // console.log(countdown_3minam_dn1);
                    }

                    const ho_dn = arr_new_dn[0][1].substr(0, 2);
                    const mi_dn = arr_new_dn[0][1].substr(2, 2);
                    const se_dn = arr_new_dn[0][1].substr(4, 2);

                    const targetDate_dn = new Date(years, month, date, ho_dn, mi_dn, se_dn);
                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_dn - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_suro_dn");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }

            });





            $.ajax({
            method: "GET",

            url: "https://openapi.kric.go.kr/openapi/trainUseInfo/subwayTimetable?serviceKey=$2a$10$l3epFs0f4zM9qRe7x9hXueiHsovU.Jb7PomRkK.qvlSCP5sDVZdpW&format=json&railOprIsttCd=BG&dayCd=" + day_cd + "&lnCd=B1&stinCd=0107"
        })
            .done(function (p) {
            //   console.log(p);
                var time = new Date();
                var years = time.getFullYear();
                var month = time.getMonth();
                var date = time.getDate();

                var hours = time.getHours();

                if (hours < 10 && hours > 0) {
                    hours = '0' + hours;
                } else if (hours == 0) {
                    hours = '24';
                } else {
                    hours = hours;
                }

                var minutes = time.getMinutes();
                var seconds = time.getSeconds();

                var cur_time = (hours) + '' + (minutes < 10 ? `0${minutes}` : minutes) + '' + (seconds < 10 ? `0${seconds}` : seconds);
                //  console.log(cur_time);

                var arr_new = new Array();
                var arr_new_up = new Array();
                var arr_new_dn = new Array();

                for (i = 0; i < p.body.length; i++) {
                    arr_new.push([p.body[i].trnNo, p.body[i].arvTm]);
                }



                const arr_new1 = arr_new.map(row => {
                    return row.map(str => {
                        if (str === "000425") {
                            return "240425";
                        } else if (str === "000030") {
                            return "240030";
                        } else if (str === "001655") {
                            return "241655";
                        }
                        else {
                            return str;
                        }
                    });
                });



               // console.log(arr_new1); 

                arr_new1.sort(function (a, b) {
                    return a[0] - b[0];
                });

                let sorted_new_arr = [];

                // 작은 값부터 큰 값 순으로 새로운 배열에 저장
                for (let i = 0; i < arr_new1.length; i++) {
                    sorted_new_arr.push(arr_new1[i]);
                }

                // console.log(sorted_new_arr_3minam);


                for (i = 0; i < sorted_new_arr.length; i++) {

                    new_3sub = cur_time - arr_new1[i][1];
                    // console.log(sorted_new_arr_4minam_dn[i][0]);

                    if (new_3sub < 0) {
                        if (sorted_new_arr[i][0] > 2000) {
                            arr_new_dn.push(sorted_new_arr[i]);
                        } 
                    }
                }
                   
               //     console.log(arr_new_dn);
               

/*
                if (cur_time > 240030 && cur_time <= 245959) {

                    $("#dj_up").append("열차운행 종료<br>");
                    $("#dj_up").append("<div class='gr-line'></div>");
                } else {

                    var length_up = arr_new_up.length;

                    if (length_up > 3) {
                        length_up = 3;
                    }


                    for (i = 0; i < length_up; i++) {

                        var arv_up_tm = arr_new_up[i][1].substr(0, 2) + ':' + arr_new_up[i][1].substr(2, 2) + ':' + arr_new_up[i][1].substr(4, 2);

                        $("#suro_up").append(arv_up_tm + "<br>");
                        $("#suro_up").append("<div class='gr-line'></div>");
                    }


                    const ho_up = arr_new_up[0][1].substr(0, 2);
                    const mi_up = arr_new_up[0][1].substr(2, 2);
                    const se_up = arr_new_up[0][1].substr(4, 2);


                    const targetDate_up = new Date(years, month, date, ho_up, mi_up, se_up);

                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_up - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_dj_up");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }
                */
                if (cur_time > 241655 && cur_time <= 245959) {

                    $("#dj_dn").append("열차운행 종료");
                    $("#dj_dn").append("<div class='gr-line'></div>");

                } else {
                    var length_dn = arr_new_dn.length;

                    if (length_dn > 3) {
                        length_dn = 3;
                    }

                    //  var length_3dn = 5;

                    for (i = 0; i < length_dn; i++) {
                        var arv_dn_tm = arr_new_dn[i][1].substr(0, 2) + ':' + arr_new_dn[i][1].substr(2, 2) + ':' + arr_new_dn[i][1].substr(4, 2);

                        const ho_dn_i = arr_new_dn[i][1].substr(0, 2);
                        const mi_dn_i = arr_new_dn[i][1].substr(2, 2);
                        const se_dn_i = arr_new_dn[i][1].substr(4, 2);
                        const targetDate_dn_i = new Date(years, month, date, ho_dn_i, mi_dn_i, se_dn_i);

                        const now1 = new Date().getTime();
                        const timeLeft1 = targetDate_dn_i - now1;

                        // 남은 시간 계산
                        const days1 = Math.floor(timeLeft1 / (1000 * 60 * 60 * 24));
                        const hours1 = Math.floor((timeLeft1 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes1 = Math.floor((timeLeft1 % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds1 = Math.floor((timeLeft1 % (1000 * 60)) / 1000);

                        //  var countdown_3minam_dn1 = (hours1 < 10 ? `0${hours1}` : hours1) +':' + (minutes1 < 10 ? `0${minutes1}` : minutes1)+ ':'+ (seconds1 < 10 ? `0${seconds1}` : seconds1);
                        var countdown_3minam_dn1 = (minutes1 < 10 ? `0${minutes1}` : minutes1) + '분 ' + (seconds1 < 10 ? `0${seconds1}` : seconds1) + '초 ';

                        //   var countdown_3minam_dn1 = minutes1 +'' ;
                        //   $("#countdown_3minam_dn1").append(countdown_3minam_dn1);
                        // $("#minam_dn").append("<span class='sche5'>" + countdown_3minam_dn1 + "</span>   <span class='sche'>" + arv_3minam_dn_tm + "</span><br>");
                        $("#dj_dn").append(arv_dn_tm + "<br>");
                        $("#dj_dn").append("<div class='gr-line'></div>");

                       // console.log(countdown_3minam_dn1);
                    }

                    const ho_dn = arr_new_dn[0][1].substr(0, 2);
                    const mi_dn = arr_new_dn[0][1].substr(2, 2);
                    const se_dn = arr_new_dn[0][1].substr(4, 2);

                    const targetDate_dn = new Date(years, month, date, ho_dn, mi_dn, se_dn);
                    // 1초마다 남은 시간 업데이트
                    setInterval(function () {
                        // 현재 날짜와의 차이 계산
                        const now = new Date().getTime();
                        const timeLeft = targetDate_dn - now;

                        // 남은 시간 계산
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // 결과 출력
                        const countdownElement = document.getElementById("countdown_dj_dn");
                        countdownElement.innerHTML = `(${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds} 후 도착)`;

                        // 타겟 날짜가 지나면 종료
                        if (timeLeft < 0) {
                            clearInterval();
                            countdownElement.innerHTML = "(열차 출발)";
                        }
                    }, 1000);

                }

            });






    </script>


    <div class="top">열차도착 시간(<span id="day_hann"></span>)<br>
        <span id="apm" class="time">clock</span>,
        <span id="clock" class="time">apm</span><br>
    </div>


    <script>
        var Target = document.getElementById("clock");
        var Target_apm = document.getElementById("apm");
        function clock() {
            var time = new Date();
            var years = time.getFullYear();
            var month = time.getMonth();
            var date = time.getDate();
            var day = time.getDay();
            var week = ['일', '월', '화', '수', '목', '금', '토'];

            var hours = time.getHours();
            var minutes = time.getMinutes();
            var seconds = time.getSeconds();

            Target.innerText =
                `${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds}`;

            Target_apm.innerText = `${years}.${month + 1}.${date}(${week[day]})`;

        }
        clock();
        setInterval(clock, 1000); // 1초마다 실행
    </script>



    <div class="container">
        <div class="item item1">
            <h3 class="sche"><b>미남역 수영행</b></h3>
            <h3 id="countdown_3minam_up" class="sche1"></h3>
            <div class="gr-line"></div>
            <div>
                <h3 id="minam_up" class="sche"></h3>
            </div>
        </div>
        <div class="item item2">
            <h3 class="sche"><b>미남역 대저행</b></h3>
            <h3 id="countdown_3minam_dn" class="sche1"></h3>
            <div class="gr-line"></div>
            <div>
                <h3 id="minam_dn" class="sche"></h3>
            </div>
        </div>
        <!--
        <div class="item item3">
            <h3 class="sche"><b>미남역 안평행</b></h3>
            <h3 id="countdown_4minam" class="sche1"></h3>
            <div class="gr-line"></div>
            <div>
                <h3 id="4minam_dn" class="sche"></h3>
            </div>
        </div>
        -->

        <div class="item item4">
            <h3 class="sche"><b>대저역 수영행</b></h3>
            <h3 id="countdown_3daejeo_up" class="sche1"></h3>
            <div class="gr-line"></div>
            <div>
                <h3 id="daejeo_up" class="sche"></h3>
            </div>
        </div>

        <div class="item item5">
            <h3 class="sche"><b>수로왕릉역 사상행</b></h3>
            <h3 id="countdown_suro_up" class="sche1"></h3>
            <div class="gr-line"></div>
            <div>
                <h3 id="suro_up" class="sche"></h3>
            </div>
        </div>

        <div class="item item6">
            <h3 class="sche"><b>수로왕릉역 가야대행</b></h3>
            <h3 id="countdown_suro_dn" class="sche1"></h3>
            <div class="gr-line"></div>
            <div>
                <h3 id="suro_dn" class="sche"></h3>
            </div>
        </div>

        <div class="item item7">
            <h3 class="sche"><b>대저역 가야대행</b></h3>
            <h3 id="countdown_dj_dn" class="sche1"></h3>
            <div class="gr-line"></div>
            <div>
                <h3 id="dj_dn" class="sche"></h3>
            </div>
        </div>

    </div>

<!--
    <script>
        setInterval(function () {
            location.reload();
        }, 60000);

    </script>
-->

</body>

</html>